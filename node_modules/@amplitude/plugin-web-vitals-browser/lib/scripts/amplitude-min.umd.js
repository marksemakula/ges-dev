!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).amplitude={})}(this,function(e){"use strict";function t(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})}function n(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}"function"==typeof SuppressedError&&SuppressedError;var i=function(e,t){var n=e;try{n=decodeURI(e)}catch(e){null==t||t.error("Malformed URI sequence: ",e)}return n};let r=-1;const o=e=>{addEventListener("pageshow",t=>{t.persisted&&(r=t.timeStamp,e(t))},!0)},a=(e,t,n,i)=>{let r,o;return a=>{t.value>=0&&(a||i)&&(o=t.value-(r??0),(o||void 0===r)&&(r=t.value,t.delta=o,t.rating=((e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good")(t.value,n),e(t)))}},s=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},l=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},u=()=>{const e=l();return e?.activationStart??0},d=(e,t=-1)=>{const n=l();let i="navigate";return r>=0?i="back-forward-cache":n&&(document.prerendering||u()>0?i="prerender":document.wasDiscarded?i="restore":n.type&&(i=n.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:i}},c=new WeakMap;function f(e,t){return c.get(e)||c.set(e,new t),c.get(e)}class p{t;i=0;o=[];h(e){if(e.hadRecentInput)return;const t=this.o[0],n=this.o.at(-1);this.i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}}const h=(e,t,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const i=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return i.observe({type:e,buffered:!0,...n}),i}}catch{}},m=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let v=-1;const g=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,y=e=>{"hidden"===document.visibilityState&&v>-1&&(v="visibilitychange"===e.type?e.timeStamp:0,T())},b=()=>{addEventListener("visibilitychange",y,!0),addEventListener("prerenderingchange",y,!0)},T=()=>{removeEventListener("visibilitychange",y,!0),removeEventListener("prerenderingchange",y,!0)},w=()=>{if(v<0){const e=u(),t=document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0]?.startTime;v=t??g(),b(),o(()=>{setTimeout(()=>{v=g(),b()})})}return{get firstHiddenTime(){return v}}},P=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},A=[1800,3e3],C=(e,t={})=>{P(()=>{const n=w();let i,r=d("FCP");const l=h("paint",e=>{for(const t of e)"first-contentful-paint"===t.name&&(l.disconnect(),t.startTime<n.firstHiddenTime&&(r.value=Math.max(t.startTime-u(),0),r.entries.push(t),i(!0)))});l&&(i=a(e,r,A,t.reportAllChanges),o(n=>{r=d("FCP"),i=a(e,r,A,t.reportAllChanges),s(()=>{r.value=performance.now()-n.timeStamp,i(!0)})}))})},E=[.1,.25];let S=0,L=1/0,I=0;const M=e=>{for(const t of e)t.interactionId&&(L=Math.min(L,t.interactionId),I=Math.max(I,t.interactionId),S=I?(I-L)/7+1:0)};let x;const k=()=>x?S:performance.interactionCount??0;let F=0;class O{u=[];l=new Map;m;p;v(){F=k(),this.u.length=0,this.l.clear()}P(){const e=Math.min(this.u.length-1,Math.floor((k()-F)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&"first-input"!==e.entryType)return;const t=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>t.T){if(n?e.duration>n.T?(n.entries=[e],n.T=e.duration):e.duration===n.T&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],T:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((e,t)=>t.T-e.T),this.u.length>10){const e=this.u.splice(10);for(const t of e)this.l.delete(t.id)}this.p?.(n)}}}const R=e=>{const t=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?e():(t(e=m(e)),document.addEventListener("visibilitychange",e,{once:!0}))},B=[200,500],j=(e,t={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&P(()=>{"interactionCount"in performance||x||(x=h("event",M,{type:"event",buffered:!0,durationThreshold:0}));let n,i=d("INP");const r=f(t,O),s=e=>{R(()=>{for(const t of e)r.h(t);const t=r.P();t&&t.T!==i.value&&(i.value=t.T,i.entries=t.entries,n())})},l=h("event",s,{durationThreshold:t.durationThreshold??40});n=a(e,i,B,t.reportAllChanges),l&&(l.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(s(l.takeRecords()),n(!0))}),o(()=>{r.v(),i=d("INP"),n=a(e,i,B,t.reportAllChanges)}))})};class q{m;h(e){this.m?.(e)}}const N=[2500,4e3],D=[800,1800],H=e=>{document.prerendering?P(()=>H(e)):"complete"!==document.readyState?addEventListener("load",()=>H(e),!0):setTimeout(e)};function U(e){var t,n=(null===(t=e.entries[0])||void 0===t?void 0:t.startTime)||0;return performance.timeOrigin+n}function V(e){return{value:e.value,rating:e.rating,delta:e.delta,navigationType:e.navigationType,id:e.id,timestamp:Math.floor(U(e)),navigationStart:Math.floor(performance.timeOrigin)}}var _=function(){var e,r=null,c=(e="ampIntegrationContext","undefined"!=typeof globalThis&&void 0!==globalThis[e]?globalThis[e]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0),v=null==c?void 0:c.document,g=null==c?void 0:c.location;return{name:"web-vitals-browser",type:"enrichment",setup:function(e,c){return t(void 0,void 0,void 0,function(){var t,y;return n(this,function(n){return void 0===v||(t=i((null==g?void 0:g.href)||"",e.loggerProvider),y={"[Amplitude] Page Domain":(null==g?void 0:g.hostname)||"","[Amplitude] Page Location":t,"[Amplitude] Page Path":i((null==g?void 0:g.pathname)||"",e.loggerProvider),"[Amplitude] Page Title":"undefined"!=typeof document&&document.title||"","[Amplitude] Page URL":i(t.split("?")[0],e.loggerProvider)},((e,t={})=>{P(()=>{const n=w();let i,r=d("LCP");const l=f(t,q),c=e=>{t.reportAllChanges||(e=e.slice(-1));for(const t of e)l.h(t),t.startTime<n.firstHiddenTime&&(r.value=Math.max(t.startTime-u(),0),r.entries=[t],i())},p=h("largest-contentful-paint",c);if(p){i=a(e,r,N,t.reportAllChanges);const n=m(()=>{c(p.takeRecords()),p.disconnect(),i(!0)});for(const e of["keydown","click","visibilitychange"])addEventListener(e,()=>R(n),{capture:!0,once:!0});o(n=>{r=d("LCP"),i=a(e,r,N,t.reportAllChanges),s(()=>{r.value=performance.now()-n.timeStamp,i(!0)})})}})})(function(e){y["[Amplitude] LCP"]=V(e)}),C(function(e){y["[Amplitude] FCP"]=V(e)}),j(function(e){y["[Amplitude] INP"]=V(e)}),((e,t={})=>{C(m(()=>{let n,i=d("CLS",0);const r=f(t,p),l=e=>{for(const t of e)r.h(t);r.i>i.value&&(i.value=r.i,i.entries=r.o,n())},u=h("layout-shift",l);u&&(n=a(e,i,E,t.reportAllChanges),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(l(u.takeRecords()),n(!0))}),o(()=>{r.i=0,i=d("CLS",0),n=a(e,i,E,t.reportAllChanges),s(()=>n())}),setTimeout(n))}))})(function(e){y["[Amplitude] CLS"]=V(e)}),((e,t={})=>{let n=d("TTFB"),i=a(e,n,D,t.reportAllChanges);H(()=>{const r=l();r&&(n.value=Math.max(r.responseStart-u(),0),n.entries=[r],i(!0),o(()=>{n=d("TTFB",0),i=a(e,n,D,t.reportAllChanges),i(!0)}))})})(function(e){y["[Amplitude] TTFB"]=V(e)}),r=function(){"hidden"===v.visibilityState&&r&&(c.track("[Amplitude] Web Vitals",y),v.removeEventListener("visibilitychange",r),r=null)},v.addEventListener("visibilitychange",r)),[2]})})},execute:function(e){return t(void 0,void 0,void 0,function(){return n(this,function(t){return[2,e]})})},teardown:function(){return t(void 0,void 0,void 0,function(){return n(this,function(e){return r&&(null==v||v.removeEventListener("visibilitychange",r)),[2]})})}}};e.VERSION="1.1.0",e.plugin=_,e.webVitalsPlugin=_,Object.defineProperty(e,"__esModule",{value:!0})});
